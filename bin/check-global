#!/bin/bash

global_classes=`mktemp`
all_classes=`mktemp`

global_hpp=$1
if [[ $global_hpp == "" ]] ; then
    global_hpp=global.hpp
fi

all_files=$2
if [[ $all_files == "" ]] ; then
    all_files=`find -iname '*.hpp'`
fi

mygrep='egrep --ignore-case --no-filename --only-matching'
declaration='(template.*<.+>.*)?(class|struct)'

$mygrep "^$declaration \w+\>[^;]" -r $all_files > $all_classes

$mygrep "^$declaration \w+;" $global_hpp | \
    sed 's@.*\(class\|struct\) \(\w\+\);@\2@' > $global_classes

grep -vF -f $global_classes $all_classes | sort | uniq

rm $global_classes $all_classes

